<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Test JSON Display - Editor Fixed</title>
  <link rel="stylesheet" href="Styles.css"/>
  <style>
    /* ·∫®n ho√†n to√†n n√∫t menu v√† dropdown tr√™n desktop */
    .mobile-menu-toggle,
    .mobile-actions-toggle,
    .mobile-actions-dropdown {
      display: none;
    }
    
    /* Responsive styling for mobile */
    @media screen and (max-width: 768px) {
      .container {
        width: 100%;
        padding: 10px;
      }
      
      .header h1 {
        font-size: 1.5rem;
      }
      
      /* Mobile menu styling */
      .mobile-menu-toggle,
      .mobile-actions-toggle {
        display: block;
        position: fixed;
        z-index: 1000;
        background: #2c3e50;
        color: white;
        border: none;
        border-radius: 5px;
        padding: 8px 12px;
        font-size: 1.2rem;
        cursor: pointer;
      }
      
      .mobile-menu-toggle {
        top: 15px;
        right: 15px;
      }
      
      .mobile-actions-toggle {
        bottom: 15px;
        right: 15px;
        background: #16a085;
      }
      
      .tabs-container {
        position: relative;
      }
      
      .tabs {
        display: none;
        flex-direction: column;
        position: fixed; /* Thay ƒë·ªïi t·ª´ absolute sang fixed */
        top: 80px; /* Kho·∫£ng c√°ch ƒë·ªß l·ªõn ƒë·ªÉ tr√°nh b·ªã che b·ªüi header */
        left: 0;
        width: 100%;
        background: white;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        z-index: 100;
        max-height: 70vh; /* Gi·ªõi h·∫°n chi·ªÅu cao t·ªëi ƒëa */
        overflow-y: auto; /* Cho ph√©p cu·ªôn n·∫øu c√≥ nhi·ªÅu tab */
      }
      
      .tabs.mobile-open {
        display: flex;
      }
      
      .tabs .tab {
        width: 100%;
        margin: 0;
        padding: 15px;
        border-bottom: 1px solid #eee;
      }
      
      /* Mobile actions dropdown */
      .mobile-actions-dropdown {
        display: none;
        position: fixed;
        bottom: 60px;
        right: 15px;
        background: white;
        border-radius: 5px;
        box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        z-index: 100;
        flex-direction: column;
        width: 200px;
        max-width: 80vw;
        overflow: hidden;
      }
      
      .mobile-actions-dropdown.mobile-open {
        display: flex;
      }
      
      .mobile-action-btn {
        padding: 12px 15px;
        text-align: left;
        background: none;
        border: none;
        border-bottom: 1px solid #eee;
        font-size: 14px;
        display: flex;
        align-items: center;
        cursor: pointer;
      }
      
      .mobile-action-btn:last-child {
        border-bottom: none;
      }
      
      .mobile-action-btn:hover {
        background: #f5f5f5;
      }
      
      .mobile-action-btn .icon {
        margin-right: 10px;
        font-size: 16px;
      }
      
      .sheet-info-bar {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .month-navigator {
        width: 100%;
        margin-top: 10px;
        justify-content: center;
      }
      
      .editor-controls {
        display: none; /* Hide on mobile, replaced by our dropdown */
      }
      
      .selection-info {
        width: 100%;
        text-align: center;
        margin-top: 10px;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 5px;
        font-size: 12px;
      }
      
      .editor-help {
        display: none;
      }
      
      /* Table responsive */
      .table-wrapper {
        overflow-x: auto;
      }
      
      table {
        min-width: 600px; /* Ensure table has minimum width */
      }
    }
  </style>
</head>
<body>
  <!-- Toast / Status -->
  <div id="editorStatus" class="editor-status">Editor Ready!</div>

  <!-- Mobile Menu Toggle Button -->
  <button class="mobile-menu-toggle" id="mobileMenuToggle">‚ò∞ Menu</button>
  
  <!-- Mobile Actions Toggle Button -->
  <button class="mobile-actions-toggle" id="mobileActionsToggle">‚öôÔ∏è Thao t√°c</button>
  
  <!-- Mobile Actions Dropdown -->
  <div class="mobile-actions-dropdown" id="mobileActionsDropdown">
    <button class="mobile-action-btn" id="mobileAddRows50">
      <span class="icon">‚è¨</span> Th√™m 50 d√≤ng
    </button>
    <button class="mobile-action-btn" id="mobileSyncDrivers">
      <span class="icon">üîÑ</span> ƒê·ªìng b·ªô t√†i x·∫ø
    </button>
    <button class="mobile-action-btn" id="mobileDeleteRow">
      <span class="icon">üóëÔ∏è</span> X√≥a d√≤ng ƒëang ch·ªçn
    </button>
    <button class="mobile-action-btn" id="mobileCreateFile">
      <span class="icon">üìÑ</span> T·∫°o file th√°ng hi·ªán t·∫°i
    </button>
    <button class="mobile-action-btn" id="mobileSaveMonth">
      <span class="icon">üíæ</span> L∆∞u th√°ng
    </button>
  </div>

  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1>üìä Test Hi·ªÉn Th·ªã JSON Data - Editor Fixed</h1>
    </div>

    <!-- Tabs -->
    <div class="tabs-container">
      <div class="tabs" id="tabsContainer" role="tablist" aria-label="B·∫£ng d·ªØ li·ªáu">
        <!-- KH√îNG d√πng onclick; JS s·∫Ω bind qua EventBus -->
        <button class="tab active"  data-tab="logchuyen" aria-selected="true"  role="tab">Log chuy·∫øn <small>(3)</small></button>
        <button class="tab"         data-tab="chamcong"   aria-selected="false" role="tab">Ch·∫•m c√¥ng <small>(2)</small></button>
        <button class="tab"         data-tab="congno"     aria-selected="false" role="tab">C√¥ng n·ª£ <small>(2)</small></button>
      </div>
    </div>

    <!-- Sheet info + Month navigator -->
    <div class="sheet-info-bar">
      <div class="sheet-info" id="sheetInfo">Log chuy·∫øn: 3 b·∫£n ghi, 13 c·ªôt</div>
      <div class="month-navigator">
        <!-- KH√îNG onclick; JS b·∫Øt #btnMonthPrev/#btnMonthNext -->
        <button class="nav-btn" id="btnMonthPrev" aria-label="Th√°ng tr∆∞·ªõc"><span>‚Äπ</span></button>
        <div class="month-display" id="monthDisplay" role="button" tabindex="0" title="Nh·∫•n ƒë·ªÉ ch·ªçn th√°ng (MM/YYYY)">08/2025</div>
        <button class="nav-btn" id="btnMonthNext" aria-label="Th√°ng sau"><span>‚Ä∫</span></button>
      </div>
    </div>

    <!-- Content area -->
    <div id="contentContainer">
      <div class="table-wrapper" id="tableWrapper" role="region" aria-label="B·∫£ng d·ªØ li·ªáu">
        <!-- B·∫£ng s·∫Ω render v√†o ƒë√¢y b·ªüi dom-manager/template-renderer -->
      </div>
    </div>

    <!-- Bottom controls (s·∫Ω ·∫©n tr√™n mobile v√† thay b·∫±ng dropdown) -->
    <div class="editor-controls editor-controls-bottom">
      <!-- KH√îNG onclick; JS l·∫Øng nghe qua id -->
      <button class="editor-btn" id="btnAddRows50"   title="Th√™m 50 d√≤ng">‚è¨ +50 d√≤ng</button>
      <button class="editor-btn" id="btnSyncDrivers" title="ƒê·ªìng b·ªô t√†i x·∫ø">üîÑ ƒê·ªìng b·ªô</button>
      <button class="editor-btn" id="btnDeleteRow"   title="X√≥a d√≤ng ƒëang ch·ªçn">üóëÔ∏è X√≥a d√≤ng</button>
      <button class="editor-btn" id="createFileBtn"  title="T·∫°o file th√°ng hi·ªán t·∫°i">üìÑ T·∫°o file</button>
      <button id="saveBtn" onclick="handleSaveClick()">üíæ L∆∞u th√°ng</button>

      <div class="selection-info" id="selectionInfo">No selection</div>
      <div class="editor-help">
        üí° Shortcuts: Ctrl+D (Add Row) | Ctrl+R (Add Column) | F2 (Edit) | Arrows (Navigate)
      </div>
    </div>

    <!-- B·∫£ng input ·∫©n (n·∫øu logic c≈© c·∫ßn) -->
    <table id="inputTable" style="display:none" aria-hidden="true"></table>
  </div>

  <!-- Dropdown g·ª£i √Ω autocomplete -->
  <div id="autocompleteDropdown" style="display:none"></div>

  <!-- ===== JS (to√†n b·ªô h√†nh vi ·ªü file ngo√†i; KH√îNG c√≥ inline script) ===== -->
  <!-- Th·ª© t·ª± n·∫°p gi·ªØ nguy√™n tinh th·∫ßn b·∫£n g·ªëc ƒë·ªÉ kh√¥ng v·ª° dependency -->
  
<!--//////////////////////////////////////////////////////////////////////////////// Core systems -->
<script src="event-bus.js" defer></script>
<script src="cacheone.js" defer></script>
<script src="DataAccessLayer.js" defer></script>
<script src="template-renderer.js" defer></script>
<script src="dom-manager.js" defer></script>
<script src="model-layer.js" defer></script>
<script src="view-layer.js" defer></script>
<script src="controller.js" defer></script>

<script src="url.js" defer></script>
<script src="reader.js" defer></script>
<script src="main.js" defer></script>

  <!--////////////////////////////////////////////////////////// Mobile menu & actions functionality -->
  <script>
    // Wait for DOM to load
    document.addEventListener('DOMContentLoaded', function() {
      // Get mobile menu toggle button
      const mobileMenuToggle = document.getElementById('mobileMenuToggle');
      const tabsContainer = document.getElementById('tabsContainer');
      
      // Get mobile actions toggle button
      const mobileActionsToggle = document.getElementById('mobileActionsToggle');
      const mobileActionsDropdown = document.getElementById('mobileActionsDropdown');
      
      // Toggle menu when button is clicked
      if (mobileMenuToggle) {
        mobileMenuToggle.addEventListener('click', function() {
          if (tabsContainer) {
            tabsContainer.classList.toggle('mobile-open');
            // Close actions dropdown if open
            mobileActionsDropdown.classList.remove('mobile-open');
          }
        });
      }
      
      // Toggle actions dropdown when button is clicked
      if (mobileActionsToggle) {
        mobileActionsToggle.addEventListener('click', function() {
          if (mobileActionsDropdown) {
            mobileActionsDropdown.classList.toggle('mobile-open');
            // Close tabs menu if open
            tabsContainer.classList.remove('mobile-open');
          }
        });
      }
      
      // Hide menu when a tab is clicked
      const tabs = document.querySelectorAll('.tab');
      tabs.forEach(tab => {
        tab.addEventListener('click', function() {
          if (tabsContainer) {
            tabsContainer.classList.remove('mobile-open');
          }
        });
      });
      
      // Connect mobile action buttons to desktop counterparts
      document.getElementById('mobileAddRows50').addEventListener('click', function() {
        document.getElementById('btnAddRows50').click();
        mobileActionsDropdown.classList.remove('mobile-open');
      });
      
      document.getElementById('mobileSyncDrivers').addEventListener('click', function() {
        document.getElementById('btnSyncDrivers').click();
        mobileActionsDropdown.classList.remove('mobile-open');
      });
      
      document.getElementById('mobileDeleteRow').addEventListener('click', function() {
        document.getElementById('btnDeleteRow').click();
        mobileActionsDropdown.classList.remove('mobile-open');
      });
      
      document.getElementById('mobileCreateFile').addEventListener('click', function() {
        document.getElementById('createFileBtn').click();
        mobileActionsDropdown.classList.remove('mobile-open');
      });
      
      document.getElementById('mobileSaveMonth').addEventListener('click', function() {
        document.getElementById('saveBtn').click();
        mobileActionsDropdown.classList.remove('mobile-open');
      });
      
      // Close dropdowns when clicking outside
      document.addEventListener('click', function(event) {
        if (!event.target.closest('.mobile-menu-toggle') && 
            !event.target.closest('.tabs') && 
            !event.target.closest('.mobile-actions-toggle') && 
            !event.target.closest('.mobile-actions-dropdown')) {
          tabsContainer.classList.remove('mobile-open');
          mobileActionsDropdown.classList.remove('mobile-open');
        }
      });
    });
  </script>

  <!-- Entry: g·∫Øn event cho HTML qua EventBus, kh√¥ng ƒë·ªÉ h√†m trong HTML -->
  <script src="main.js" defer></script>
</body>
</html>